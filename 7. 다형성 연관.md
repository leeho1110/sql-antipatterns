# 7. 다형성 연관

- 만약 우리가 댓글 시스템을 개발한다고 가정해보자. 이 때 댓글을 버그 뿐만 아니라 기능 요청에서도 달 수 있다고 생각해보면 어떻게 테이블을 설계해야할까?
    - 댓글 테이블의 부모를 명시하는 컬럼에는 버그의 식별자가 들어가야할까? 아니면 기능 요청의 식별자가 들어가야할까? 아니면 둘 다 들어가야할까?
    - 우린 하나의 컬럼에 두 개의 외래키를 지정할 수 없다. 여기서 발생하는 문제가 바로 다형성 연관 문제다.
- 여기서 또 하나의 안티패턴을 발견할 수 있다. 바로 외래키를 지정하지 않는 것이다.
    - 버그의 식별자가 들어가든, 기능 요청의 식별자가 들어가든 둘의 타입이 서로 동일하다면 값은 정상적으로 삽입될 것이다.
    - 따라서 이 때 우린 식별자의 타입을 알려주는 별도의 타입을 명시해 이것이 버그로부터 작성됐는지, 기능 요청으로부터 작성됐는지 알 수 있다.
    - 하지만 만약 둘의 식별자가 겹친다면 어떻게 될까?
- 만약 하이버네이트와 같은 ORM 프레임워크를 사용한다면 다형성 연관 관계가 애플리케이션 내에서 정합성을 보장하기 때문에 허용될 수 있다.
- 이런 문제점을 해결하기 위해 취할 수 있는 가장 간단한 방법은 데이터베이스의 테이블 재설계다.
    - 바로 연관관계의 참조를 역으로 설정하는 것이다.
    - 지금까지는 댓글 테이블이 부모에 대한 참조를 명시하고 있었다.
        - `comment` 테이블 내에 `bugs_id` 혹은 `request_id` 를 갖는 형태로 말이다.
    - 하지만 개선된 형태에서는 참조의 방향이 `Comment` → `Bug` or `Request` 가 아닌 교차 테이블 형태를 통해 역방향으로 변경된다.
        - `Bug` → `Bugs Comments` ← `Comments`
        - `Request` → `Request Comments` ← `Comments`
    - 이를 통해 댓글 테이블의 식별자의 타입을 알려주는 컬럼을 없앨 수 있다.
- 혹은 슈퍼 테이블을 통해 해결할 수도 있다.