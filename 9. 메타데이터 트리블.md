# 9. 메타데이터 트리블

- 각 고객의 연별 매출을 나타내는 테이블을 만드는 상황을 생각해보자. 우리는 여러 가지를 고려해야했다.
    - 우선 고객은 테이블 내에 하나의 행으로 존재할텐데 어떻게 매출을 기록할까?
    - 아마 책을 제대로 읽었다면 8장과 같은 형태로 종속 테이블을 먼저 생각할 것이다. 하지만 역시 안티패턴을 소개하기 위해 본문에서는 연도별 컬럼을 대뜸 추가한다.
- 트리블의 어원은 스타트렉이다. 특이한 번식 성향으로 인해 개체 수가 무지막지하게 들어나는 것을 통제할 수 없는 문제를 갖고 있다. 메타데이터 트리블도 같은 의미다. 잘못된 설계로 인해 테이블이 무지막지하게 늘어나는 문제다.
- 만약 메타데이터를 저장하기 위해 연도별로 테이블을 새로 생성한다고 가정해보자. 이 때는 어떤 문제가 발생할까?
    - 연도별 테이블의 생성을 깜빡하는 경우가 있다.
    - 다른 연도의 레코드를 집어넣는 경우도 있을 것이다.
    - 연도가 다르다면 데이터를 수정할 때도 두개의 테이블을 건드려야 한다. 아마 하나의 테이블의 레코드를 삭제하고 다른 곳으로 생성을 통해 옮기는 절차가 필요할테다.
    - 심지어 PK도 보장할 수 없다. 새로 생성될 때마다 모든 테이블을 통합해 PK를 검증하지 않는다면 말이다.
    - 조회할 때도 테이블을 모두 합쳐 조건절에 일치하는 검색 결과를 반환해야한다.
    - 컬럼 추가도 마찬가지다. 참조 정합성은 말할 것도 없다. 이젠 슬슬 손가락이 아플 지경이다.
- 만약 너무너무 거대한 데이터를 저장해야하며, 오래 전의 데이터를 조회할 필요가 없는 경우가 있다면 이런 안티패턴이 유효하기도 하다.
    - WordPress에서 블로그의 내용을 저장하는 테이블에 이런 안티패턴을 유효하게 사용한 사례가 있다.
- 이를 해결하기 위해서 파티셔닝을 사용할 수 있다.
    - 파티셔닝 중 수평 파티셔닝은 거대한 테이블을 수평적으로 자르는 방식이다.
        - 예를 들어 1부터 10,000까지의 레코드가 저장되어 있다면 1,000개씩 잘라 10개의 덩어리로 만드는 것이다.
    - 만약 크기가 큰 칼럼이 존재하거나 거의 사용되지 않는 컬럼이 명확하다면 수직 파티셔닝을 통해 세로로 쪼갤 수 있다.
        - BLOB, TEXT 와 같은 타입을 갖는 컬럼들은 대부분 셀 내부의 데이터가 크기가 크고 가변적이기 때문에 수직 파티셔닝이 효율적일 수 있다.
    - 마지막으로 맨 처음 얘기했던 종속 테이블을 만드는 것으로도 해결이 가능하다.