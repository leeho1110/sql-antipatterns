# 16. 임의의 선택

- 무작위로 광고를 균등하게 배분된 분포로 선택하려면 어떻게 해야할까요?
    - 만약 `SELECT * FROM Bugs ORDER BY RAND() LIMIT 1;` 과 같은 쿼리로 수행하고 있다면 당장 그만두는 것을 권합니다.
    - `RAND()` 와 같은 비결정적 수식으로 정렬하는 경우 인덱스를 활용할 수 없다는 치명적인 단점이 존재합니다.
- 이렇게 데이터를 임의로 정렬한 뒤 선택하는 기법은 어떻게 해결할까요?
    - 위 문제에서의 핵심은 ‘임의로 정렬’ 입니다. 따라서 우린 테이블이 임의로, 그리고 전체적으로 정렬되는 것을 피하면 됩니다.
- 아마 아래와 같은 방법들을 사용할 수 있습니다.
    1. 1과 PK의 최댓값 중 하나를 선택합니다.
    2. 다음으로 큰 키 값 고르기
        - 이 방법은 PK 사이에 빈틈이 존재하는 경우 사용할 수 있습니다.
    3. 모든 키 값의 목록을 구하고, 임의로 하나 고르기
        - 이 작업은 임의의 값을 구하는 과정을 애플리케이션에서 실행합니다.
        - 따라서 애플리케이션에 전체 데이터를 가져올 때 리스트의 크기가 클수도 있다는 단점이 존재합니다.
        - 임의의 값을 구한 뒤 해당 ID와 일치하는 쿼리를 다시 한번 실행하기 때문에 쿼리를 2번 실행해야한다는 단점도 존재합니다.
    4. 오프셋을 이용해 임의로 고르기
        - `OFFSET` 절을 통해 임의 범위를 자른 뒤 첫번째 행을 가져옵니다.
    5. 벤더 종속적인 방법
        - MS-SQL에서는 `TABLESAMPLE`
        - Oracle에서는 `SAMPLE` 절을 지원합니다.